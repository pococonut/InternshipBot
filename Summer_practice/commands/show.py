from create import dp
from aiogram import types
from db.commands import select_user
from keyboard import change_user_ikb
from commands.general import print_stud


def print_worker(w):
    """
    –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
    :param w: –°—Ç—Ä–æ–∫–∞ –º–æ–¥–µ–ª–∏ –ë–î, –æ—Ç–Ω–æ—Å—è—â–∞—è—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É, —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–µ–º.
    :return: –°—Ç—Ä–æ–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.
    """
    worker = f"<b>–§–ò–û:</b> {w.name}\n\n" \
             f"<b>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</b> {w.phone}\n\n" \
             f"<b>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</b> {w.reg_date}\n"
    return worker


def show_inf(t_id):
    """
    –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ç–∏–ø–∞.
    :param t_id: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ telegram
    :return: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    inf = None
    user_show = select_user(t_id)
    if user_show is not None:
        if user_show.type == 'student':
            inf = print_stud(user_show)
        else:
            inf = print_worker(user_show)
    return inf


@dp.message_handler(commands=['show'])
async def show_params(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    inf = show_inf(message.from_user.id)
    if inf is None:
        await message.answer('–í—ã –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ —ç—Ç–∞–ø —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.')
    else:
        await message.answer(f"üßë‚Äçüíª<b>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</b>\n\n" + inf, parse_mode='HTML', reply_markup=change_user_ikb)


@dp.callback_query_handler(text='show')
async def show_params_inline(callback: types.CallbackQuery):
    """
    –§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    inf = show_inf(callback.from_user.id)
    if inf is None:
        await callback.message.edit_text('–í—ã –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ —ç—Ç–∞–ø —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.')
    else:
        await callback.message.edit_text(f"üßë‚Äçüíª<b>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</b>\n\n" + inf, parse_mode='HTML', reply_markup=change_user_ikb)